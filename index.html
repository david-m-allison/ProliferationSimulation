<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Nuclear Proliferation Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: row;
            width: 100%;
            max-width: 1400px;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        .controls {
            flex: 1;
            min-width: 380px;
            max-width: 450px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .visualization {
            flex: 2.5;
            min-width: 600px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }
        h1, h2, h3 {
            text-align: center;
            color: #343a40;
        }
        h1 { margin-bottom: 5px; font-size: 2rem; }
        .subtitle { text-align: center; margin-top: 0; color: #6c757d; margin-bottom: 20px; }
        .control-group {
            margin-bottom: 25px;
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }
        .control-group h3 {
            margin-top: 0;
            text-align: left;
            color: #495057;
        }
        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        label {
            font-weight: 500;
        }
        input[type="range"] {
            width: 55%;
        }
        .value-display {
            font-weight: bold;
            min-width: 50px;
            text-align: right;
            background-color: #e9ecef;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .results-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .result-item {
            text-align: center;
        }
        .result-item .label {
            font-size: 1rem;
            color: #6c757d;
        }
        .result-item .value {
            font-size: 1.75rem;
            font-weight: bold;
            color: #007bff;
        }
        .presets {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .presets button {
            padding: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            transition: background-color 0.2s;
        }
        .presets button.active {
             background-color: #007bff;
        }
        .presets button:hover {
            background-color: #5a6268;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .checkbox-item input {
            width: 18px;
            height: 18px;
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
            color: #007bff;
            font-weight: bold;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #343a40;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 10;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
            pointer-events: none;
        }
        .tooltip .tooltiptext.show {
             visibility: visible;
             opacity: 1;
        }
        .tooltip .tooltiptext.align-left {
            left: 0;
            transform: translateX(0);
        }
         .tooltip .tooltiptext.align-right {
            left: auto;
            right: 0;
            transform: translateX(0);
        }
        .chart-container {
            position: relative;
            height: 220px; 
            width: 100%;
            margin-bottom: 15px;
        }
        .warning-box {
            display: none;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
        }
    
@media (max-width: 768px) {
  .container {
    flex-direction: column;
    align-items: stretch;
  }

  .controls,
  .visualization {
    min-width: 100% !important;
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box;
  }

  .chart-container {
    height: 200px;
  }
}
*, *::before, *::after {
  box-sizing: border-box;
}

</style>
</head>
<body>

    <header>
        <h1>The Technological Arms Race for Nuclear (In)visibility</h1>
        <p class="subtitle">An Interactive Simulation Model</p>
    </header>

    <div class="container">
        <div class="controls">
            <h2>Control Panel</h2>

            <div class="control-group">
                <h3>Preset Scenarios</h3>
                <div class="presets">
                    <button id="preset-limited">Limited AI</button>
                    <button id="preset-disruptive">Disruptive AI</button>
                    <button id="preset-transformative">Transformative AI</button>
                </div>
            </div>

            <div class="control-group">
                 <div class="control-item checkbox-item">
                    <label for="moonshot">DET "Moonshot"
                        <span class="tooltip">?
                            <span class="tooltiptext">Simulates a concerted, well-funded effort to improve detection technologies, with larger and earlier capability jumps.</span>
                        </span>
                    </label>
                    <input type="checkbox" id="moonshot">
                </div>
                <div class="control-item checkbox-item">
                    <label for="opportunistic">Opportunistic Breakout
                         <span class="tooltip">?
                            <span class="tooltiptext">Models the idea that more states might attempt a breakout if they perceive a significant and sustained advantage over detectors (high positive RAI).</span>
                        </span>
                    </label>
                    <input type="checkbox" id="opportunistic">
                </div>
            </div>
            
            <div class="control-group">
                <h3>Proliferation-Enabling Tech. (PET)</h3>
                 <div class="control-item">
                    <label for="petDoublingTime">Doubling Time (months)
                         <span class="tooltip">?
                            <span class="tooltiptext">The time it takes for PET capabilities to double. Faster doubling (lower number) leads to steeper exponential growth. Corresponds to growth rate 'g'.</span>
                        </span>
                    </label>
                    <input type="range" id="petDoublingTime" min="6" max="48" value="36" step="1">
                    <span class="value-display" id="petDoublingTime-value">36</span>
                </div>
                <div class="control-item">
                    <label for="petCeiling">Capability Ceiling (Pₘₐₓ)
                         <span class="tooltip">?
                            <span class="tooltiptext">The maximum theoretical capability for PETs, representing physical or throughput constraints. The growth curve flattens as it approaches this ceiling.</span>
                        </span>
                    </label>
                    <input type="range" id="petCeiling" min="50" max="200" value="120" step="5">
                    <span class="value-display" id="petCeiling-value">120</span>
                </div>
            </div>
            
            <div class="control-group">
                <h3>Detection & Proliferation Dynamics</h3>
                <div class="control-item">
                    <label for="detectionFloor">Detection Floor (π₀)
                        <span class="tooltip">?
                            <span class="tooltiptext">The irreducible minimum probability of detection, representing the chance of discovery through non-technical means like human intelligence or random luck.</span>
                        </span>
                    </label>
                    <input type="range" id="detectionFloor" min="0.01" max="0.25" value="0.10" step="0.01">
                    <span class="value-display" id="detectionFloor-value">0.10</span>
                </div>
                 <div class="control-item">
                    <label for="opportunismThreshold">Opportunism Threshold (τ)
                        <span class="tooltip">?
                            <span class="tooltiptext">The RAI value above which states begin to feel confident enough to attempt opportunistic breakouts.</span>
                        </span>
                    </label>
                    <input type="range" id="opportunismThreshold" min="10" max="80" value="40" step="5">
                    <span class="value-display" id="opportunismThreshold-value">40</span>
                </div>
                 <div class="control-item">
                    <label for="opportunismBoost">Opportunism Boost (η)
                         <span class="tooltip">?
                            <span class="tooltiptext">The maximum multiplier for the breakout attempt rate when RAI is very high. An η of 3 means the attempt rate can increase up to four-fold (1+3).</span>
                        </span>
                    </label>
                    <input type="range" id="opportunismBoost" min="0" max="5" value="3" step="any">
                    <span class="value-display" id="opportunismBoost-value">3.0</span>
                </div>
            </div>

            <div class="control-group">
                <h3>Initial Conditions</h3>
                 <div class="control-item">
                    <label for="initialPet">Initial PET Capability (P₀)
                         <span class="tooltip">?
                            <span class="tooltiptext">The starting capability score for proliferation-enabling technologies at Year 0.</span>
                        </span>
                    </label>
                    <input type="range" id="initialPet" min="0" max="100" value="20" step="1">
                    <span class="value-display" id="initialPet-value">20</span>
                </div>
                 <div class="control-item">
                    <label for="initialDet">Initial DET Capability (D₀)
                         <span class="tooltip">?
                            <span class="tooltiptext">The starting capability score for detection-enhancing technologies at Year 0.</span>
                        </span>
                    </label>
                    <input type="range" id="initialDet" min="0" max="100" value="50" step="1">
                    <span class="value-display" id="initialDet-value">50</span>
                </div>
            </div>

        </div>
        <div class="visualization">
            <div class="results-display">
                <div class="result-item">
                    <div class="label">Cumulative Risk R(10)</div>
                    <div class="value" id="r10-value">0.000</div>
                </div>
                <div class="result-item">
                    <div class="label">P(At Least One Breakout)</div>
                    <div class="value" id="p10-value">0.00%</div>
                </div>
            </div>
            <div class="warning-box" id="warning-box"></div>
            <div class="chart-container">
                 <canvas id="capabilityChart"></canvas>
            </div>
             <div class="chart-container">
                 <canvas id="raiChart"></canvas>
            </div>
             <div class="chart-container">
                 <canvas id="riskChart"></canvas>
            </div>
            <div class="disclaimer-text">
                Note: This model is intended as a conceptual framework, not a forecast—its purpose is to help users explore how imbalances in technology growth may shape proliferation risks and inform strategic choices.
            </div>

        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const capCtx = document.getElementById('capabilityChart').getContext('2d');
    const raiCtx = document.getElementById('raiChart').getContext('2d');
    const riskCtx = document.getElementById('riskChart').getContext('2d');
    let capabilityChart, raiChart, riskChart;

    function createCharts() {
        if (capabilityChart) capabilityChart.destroy();
        if (raiChart) raiChart.destroy();
        if (riskChart) riskChart.destroy();

        const commonXAxisOptions = {
            title: { display: true, text: 'Time (Years)' },
            ticks: {
                callback: function(value, index) {
                    const label = this.getLabelForValue(index);
                    if (parseFloat(label) % 1 === 0) return label;
                    return null;
                },
                autoSkip: false, maxRotation: 0
            }
        };

        capabilityChart = new Chart(capCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'PET Capability P(t)', data: [], borderColor: 'rgba(165, 15, 21, 0.8)', borderWidth: 2.5, pointRadius: 0 },
                    { label: 'DET Capability D(t)', data: [], borderColor: 'rgba(4, 90, 141, 0.8)', borderWidth: 2.5, pointRadius: 0, stepped: true }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { title: { display: true, text: 'Capability Score' , font: { weight: 'bold' }} }, x: commonXAxisOptions },
                plugins: { legend: { position: 'bottom' } }
            }
        });

        raiChart = new Chart(raiCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Relative Advantage Index RAI(t)', data: [], borderWidth: 4, pointRadius: 0, segment: { borderColor: ctx => ctx.p1.raw >= 0 ? 'rgba(220, 53, 69, 0.7)' : 'rgba(0, 123, 255, 0.7)' } },
                    { label: 'RAI = 0', data: [], borderColor: 'rgba(0, 0, 0, 0.8)', borderWidth: 1, pointRadius: 0 },
                    { label: 'Opportunism Threshold', data: [], borderColor: 'rgba(220, 53, 69, 0.7)', borderWidth: 2, pointRadius: 0, borderDash: [6, 6] }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { title: { display: true, text: 'Relative Advantage Index (RAI)', font: { weight: 'bold' } } }, x: commonXAxisOptions },
                plugins: { legend: { display: false } }
            }
        });

        riskChart = new Chart(riskCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: 'Cumulative Risk R(t)', data: [], borderColor: 'rgba(220, 53, 69, 0.8)', backgroundColor: 'rgba(220, 53, 69, 0.2)', borderWidth: 3, pointRadius: 0, fill: true }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { 
                    y: { 
                        min: 0, 
                        max: 1.5, 
                        title: { display: true, text: 'Cumulative Risk R(t)', font: { weight: 'bold' } } 
                    }, 
                    x: commonXAxisOptions 
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function calculatePET(t, g, p0, pMax) {
        if (g <= 0 || pMax <= p0) return p0;
        const ratio = pMax / p0 - 1;
        if (ratio <= 0) return p0;
        const t50 = Math.log(ratio) / g;
        return pMax / (1 + Math.exp(-g * (t - t50)));
    }

    function calculateDET(t, d0, steps, deltas) {
        let dNow = d0;
        for (let i = 0; i < steps.length; i++) {
            if (t >= steps[i]) { dNow += deltas[i]; }
        }
        return dNow;
    }

    function calculateDetectionProbability(rai, kappa, floor) { return floor + (1 - floor) / (1 + Math.exp(kappa * rai)); }
    function calculateHazardRate(rai, isOpp, l0, eta, beta, tau) { if (!isOpp) return l0; const boost = 1 + eta * (1 / (1 + Math.exp(-beta * (rai - tau)))); return l0 * boost; }
    
    function runSimulation(params) {
        const { g, moonshot, opportunistic, p0, d0, petCeiling, detectionFloor, opportunismThreshold, opportunismBoost } = params;
        const t_horizon = 10, dt = 0.05;
        const det_steps = moonshot ? [1, 3, 6] : [3, 7];
        const det_deltas = moonshot ? [12, 10, 10] : [5, 4];
        const kappa = moonshot ? 0.6 : 0.4;
        let cumulativeRisk = 0;
        const ts = { t: [], p_t: [], d_t: [], rai: [], r_t: [] };

        for (let t = 0; t <= t_horizon; t += dt) {
            const p_t = calculatePET(t, g, p0, petCeiling);
            const d_t = calculateDET(t, d0, det_steps, det_deltas);
            const rai = p_t - d_t;
            const detProb = calculateDetectionProbability(rai, kappa, detectionFloor);
            const hazardRate = calculateHazardRate(rai, opportunistic, 0.05, opportunismBoost, 0.1, opportunismThreshold);
            cumulativeRisk += hazardRate * (1 - detProb) * dt;
            ts.t.push(t.toFixed(2));
            ts.p_t.push(p_t);
            ts.d_t.push(d_t);
            ts.rai.push(rai);
            ts.r_t.push(cumulativeRisk);
        }
        const p10 = 1 - Math.exp(cumulativeRisk > 0 ? -cumulativeRisk : 0);
        return { timeSeries: ts, R10: cumulativeRisk, P10: p10 };
    }

    const controls = {
        petDoublingTime: document.getElementById('petDoublingTime'),
        petCeiling: document.getElementById('petCeiling'),
        moonshot: document.getElementById('moonshot'),
        opportunistic: document.getElementById('opportunistic'),
        detectionFloor: document.getElementById('detectionFloor'),
        opportunismThreshold: document.getElementById('opportunismThreshold'),
        opportunismBoost: document.getElementById('opportunismBoost'),
        initialPet: document.getElementById('initialPet'),
        initialDet: document.getElementById('initialDet'),
    };
    
    const valueDisplays = {
        petDoublingTime: document.getElementById('petDoublingTime-value'),
        petCeiling: document.getElementById('petCeiling-value'),
        detectionFloor: document.getElementById('detectionFloor-value'),
        opportunismThreshold: document.getElementById('opportunismThreshold-value'),
        opportunismBoost: document.getElementById('opportunismBoost-value'),
        initialPet: document.getElementById('initialPet-value'),
        initialDet: document.getElementById('initialDet-value'),
    };

    const resultDisplays = { r10: document.getElementById('r10-value'), p10: document.getElementById('p10-value') };
    const presetButtons = { limited: document.getElementById('preset-limited'), disruptive: document.getElementById('preset-disruptive'), transformative: document.getElementById('preset-transformative') };
    const warningBox = document.getElementById('warning-box');

    function updateApp() {
        const p0 = parseFloat(controls.initialPet.value);
        const d0 = parseFloat(controls.initialDet.value);
        const opportunismThreshold = parseFloat(controls.opportunismThreshold.value);
        const opportunistic = controls.opportunistic.checked;

        if (p0 > d0) {
            warningBox.style.display = 'block';
            warningBox.textContent = "Warning: P(0) > D(0). Assuming proliferators start with an advantage may lead to unrealistically high risk predictions.";
        } else {
            warningBox.style.display = 'none';
        }

        const simulationParams = {
            g: Math.log(2) / (parseFloat(controls.petDoublingTime.value) / 12),
            moonshot: controls.moonshot.checked,
            opportunistic, p0, d0,
            petCeiling: parseFloat(controls.petCeiling.value),
            detectionFloor: parseFloat(controls.detectionFloor.value),
            opportunismThreshold,
            opportunismBoost: parseFloat(controls.opportunismBoost.value),
        };

        const results = runSimulation(simulationParams);

        Object.keys(valueDisplays).forEach(key => {
            const control = controls[key];
            const display = valueDisplays[key];
            display.textContent = (key === 'detectionFloor' || key === 'opportunismBoost') ? parseFloat(control.value).toFixed(2) : control.value;
        });

        resultDisplays.r10.textContent = results.R10.toFixed(3);
        resultDisplays.p10.textContent = (results.P10 * 100).toFixed(2) + '%';
        
        capabilityChart.data.labels = results.timeSeries.t;
        capabilityChart.data.datasets[0].data = results.timeSeries.p_t;
        capabilityChart.data.datasets[1].data = results.timeSeries.d_t;
        capabilityChart.update();
        
        const numPoints = results.timeSeries.t.length;
        raiChart.data.labels = results.timeSeries.t;
        raiChart.data.datasets[0].data = results.timeSeries.rai;
        raiChart.data.datasets[1].data = new Array(numPoints).fill(0);
        raiChart.data.datasets[2].data = opportunistic ? new Array(numPoints).fill(opportunismThreshold) : [];
        raiChart.update();
        
        riskChart.data.labels = results.timeSeries.t;
        riskChart.data.datasets[0].data = results.timeSeries.r_t;
        riskChart.update();

        updateActiveButton(parseFloat(controls.petDoublingTime.value));
    }

    function resetToDefaults() {
        controls.petCeiling.value = 120;
        controls.detectionFloor.value = 0.10;
        controls.opportunismThreshold.value = 40;
        controls.opportunismBoost.value = 3.0;
        controls.initialPet.value = 20;
        controls.initialDet.value = 50;
        controls.moonshot.checked = false;
        controls.opportunistic.checked = false;
    }

    function updateActiveButton(doublingTime) {
        Object.values(presetButtons).forEach(btn => btn.classList.remove('active'));
        const presetsMap = { 36: 'limited', 25: 'disruptive', 7: 'transformative' };
        const activeKey = presetsMap[doublingTime];
        if (activeKey) {
            presetButtons[activeKey].classList.add('active');
        }
    }

    function setPreset(doublingTime) {
        resetToDefaults();
        controls.petDoublingTime.value = doublingTime;
        updateApp();
    }
    
    Object.values(controls).forEach(control => control.addEventListener('input', updateApp));
    presetButtons.limited.addEventListener('click', () => setPreset(36));
    presetButtons.disruptive.addEventListener('click', () => setPreset(25));
    presetButtons.transformative.addEventListener('click', () => setPreset(7));

    const tooltips = document.querySelectorAll('.tooltip');
    tooltips.forEach(tooltip => {
        const tooltipText = tooltip.querySelector('.tooltiptext');
        tooltip.addEventListener('mouseenter', () => {
            tooltipText.classList.add('show');
            const rect = tooltipText.getBoundingClientRect();
            tooltipText.classList.remove('align-left', 'align-right');
            if (rect.left < 10) {
                tooltipText.classList.add('align-left');
            } else if (rect.right > window.innerWidth - 10) {
                tooltipText.classList.add('align-right');
            }
        });
        tooltip.addEventListener('mouseleave', () => {
            tooltipText.classList.remove('show');
        });
    });

    createCharts();
    setPreset(36);
});
</script>

</body>
</html>
